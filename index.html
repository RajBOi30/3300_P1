<html>

<head>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    .gridlines line {
      stroke: #bbb;
    }

    .gridlines .domain {
      stroke: none;
    }
  </style>
</head>

<body>
  <h3>
    Graph 1: Visualizing the relationship between Pokemon Health and Damage.
  </h3>
  <svg id="graph1" height="700" width="1000" style="background:beige"></svg>
  <script>
    const svg = d3.select('svg#graph1');
    const margins = { top: 10, right: 10, bottom: 10, left: 10 };
    const chartWidth = svg.attr("width") - margins.right - margins.left;
    const chartHeight = svg.attr("height") - margins.top - margins.bottom;

    d3.csv('pokemon_data.csv').then(data => {
      console.log(data);

      const attackExtent = d3.extent(data, d => Number(d.attack));
      const hpExtent = d3.extent(data, d => Number(d.hp));

      const xScale = d3.scaleLinear().domain([attackExtent[0] - 5, attackExtent[1]]).range([0, chartWidth]);
      const yScale = d3.scaleLinear().domain([hpExtent[0], hpExtent[1] + 5]).range([chartHeight, 0]);

      let verticalAxis = d3.axisLeft(yScale);
      svg.append('g')
        .attr('transform', `translate(${margins.left + chartWidth / 2}, ${margins.top})`)
        .call(verticalAxis);

      let horizontalAxis = d3.axisBottom(xScale);
      svg.append('g')
        .attr('transform', `translate(${margins.left}, ${margins.top + chartHeight / 2})`)
        .call(horizontalAxis);

      svg.append('text')
        .text("Hunky Chunky")
        .attr('font-size', 30)
        .attr('x', chartWidth - 200)
        .attr('y', 50);
      svg.append('text')
        .text("High Damage, Low Health")
        .attr('font-size', 20)
        .attr('x', chartWidth - 200)
        .attr('y', chartHeight);
      svg.append('text')
        .text("Low Damage, High Health")
        .attr('font-size', 20)
        .attr('x', 0)
        .attr('y', 20);
      svg.append('text')
        .text("Low Damage, Low Health")
        .attr('font-size', 20)
        .attr('x', 0)
        .attr('y', chartHeight);


      function jitter() {
        return (Math.random() * 20) - 10;
      }

      var colorMap = {};
      colorMap['normal'] = 'pink';
      colorMap['fire'] = 'orange';
      colorMap['water'] = 'blue';
      colorMap['grass'] = 'green';
      colorMap['electric'] = 'yellow';
      colorMap['fighting'] = 'red';
      colorMap['ground'] = 'brown';
      colorMap['psychic'] = 'magenta';
      colorMap['bug'] = 'light green';
      colorMap['dragon'] = 'dark blue';
      colorMap['rock'] = 'gray';
      colorMap['ghost'] = 'dark purple';
      colorMap['dark'] = 'black';
      colorMap['steel'] = 'light blue';

      data.forEach(d => {
        let x = xScale(d.attack) + jitter();
        let y = yScale(d.hp) + jitter();

        if (x > 900) {
          x -= 50;
        }
        if (y > 600) {
          y -= 50;
        }

        let color = colorMap[d.type];

        svg.append("mask")
          .attr("id", "image-mask" + d.name)
          .append("image")
          .attr('x', x)
          .attr('y', y)
          .attr('width', 50)
          .attr('height', 50)
          .attr("xlink:href", "pokemon_svg/" + (d.name).toLowerCase() + ".svg");

        // Add purple rectangle to be clipped by the mask
        svg.append("rect")
          .attr("fill", color)
          .attr("width", "100%")
          .attr("height", "100%")
          .attr("mask", "url(#image-mask" + d.name + ")"); // Apply mask
      });

      //key rectangle

      const keyXPos = chartWidth - 200;
      const keyYPos = chartHeight - 220;
      const keyWidth = 200;
      const keyHeight = 180;

      svg.append('rect')
        .attr('x', keyXPos)
        .attr('y', keyYPos)
        .attr('width', keyWidth)
        .attr('height', keyHeight)
        .attr('fill', "white");

        const typeColors = [
        { type: 'normal', color: 'pink' },
        { type: 'fire', color: 'orange' },
        { type: 'water', color: 'blue' },
        { type: 'grass', color: 'green' },
        { type: 'electric', color: 'yellow' },
        { type: 'fighting', color: 'red' },
        { type: 'ground', color: 'brown' },
        { type: 'psychic', color: 'magenta' },
        { type: 'bug', color: 'lightgreen' },
        { type: 'dragon', color: 'darkblue' },
        { type: 'rock', color: 'gray' },
        { type: 'ghost', color: 'darkpurple' },
        { type: 'dark', color: 'black' },
        { type: 'steel', color: 'lightblue' },
      ];

      //svg for key
      const key = svg.append('g').attr('class', 'key').attr('transform', 'translate(10, 10)');

      //two columns for key
      const columns = key.selectAll('.column')
        .data([typeColors.slice(0, Math.ceil(typeColors.length / 2)), typeColors.slice(Math.ceil(typeColors.length / 2))])
        .enter()
        .append('g')
        .attr('class', 'column')
        .attr('transform', (d, i) => `translate(${i * 100}, 0)`);

      columns.each(function (columnData, columnIndex) {
        d3.select(this).selectAll('.key-item')
          .data(columnData)
          .enter()
          .append('g')
          .attr('class', 'key-item')
          .attr('transform', (d, i) => `translate(0, ${i * 20})`)
          .append('circle')
          .attr('cx', chartWidth - keyWidth + 18)
          .attr('cy', chartHeight - keyHeight - 20)
          .attr('r', 7)
          .attr('fill', d => d.color);

        d3.select(this).selectAll('.key-item')
          .append('text')
          .attr('x', chartWidth - keyWidth + 28)
          .attr('y', (d, i) => chartHeight - keyHeight - 16.5)
          .text(d => d.type);
      });

    });
  </script>
  <h3>
    Graph 2: Visualizing the relationship between quadrant and speed.
  </h3>
  <svg id="graph2" height="400" width="920" style="background:beige"></svg>
  <script>
    const svg2 = d3.select("svg#graph2");
    const height2 = svg2.attr("height");
    const width2 = svg2.attr("width");
    const twoPi = Math.PI * 2;
    const percentage = 60
    const imageSize = 230

    let changeScale = d3.scaleLinear()
      .domain([0, 4])
      .range([0, width2]);

    for (let i = 0; i < 4; i++) {
      svg2.append('image')
        .attr('xlink:href', "pokeball.png")
        .attr('x', changeScale(i))
        .attr('y', height2 / 2 - (imageSize / 2))
        .attr('width', imageSize)
        .attr('height', imageSize);
      svg2.append("path")
        .attr("transform", `translate(${changeScale(i)},${height2 / 2 - (imageSize / 2)})`)
        .attr("d", d3.arc()({
          innerRadius: 0,
          outerRadius: 100,
          startAngle: 0,
          endAngle: ((100 - percentage) / 100) * twoPi
        }))
        .attr("fill", "white");
    }
  </script>


</body>

</html>